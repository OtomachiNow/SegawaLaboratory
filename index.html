<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>瀬川研究室</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="header width-constraint" id="head">
    <h1><a href="index.html">瀬川研究室</a></h1>
    <p class="subtitle">Segawa Laboratory!</p>
</div>

<div class="clm width-constraint">
    <div class="mokuzi">
        <h2>もくじ</h2>
        <p><a href="index.html">トップ</a></p>
        <p><a href="story.html">ストーリー</a></p>
        <p><a href="seminars.html">ゼミ一覧</a></p>
        <p><a href="about.html">研究室紹介</a></p>
    </div>
    <div class="main">
        <div class="setumei">
            <h1 id="home-title">瀬川研究室とは.</h1>
            <div id="home-desc"><p>東平大学理学部，瀬川修平先生の下部研究室です．</p>
<p>行われたゼミやイベントを記録しています．</p></div>
            <br/>
        </div>        
        <div class="katudou" id="katudou">
            <h1 id="nisi-title">日誌</h1>
            <div id="blog-posts"><p>読み込み中...</p></div>
        </div>
    </div>
</div>
<footer class="foot width-constraint">
    &copy; Segawa Laboratory<br>
    Contact: @now5th / yuzakinasa2357@gmail.com
</footer>


<script type="module">
    async function loadPageData() {
        const configPromise = fetch('config.json').then(res => res.json());
        const postsPromise = fetch('nisi.txt').then(res => res.text());

        configPromise.then(config => {
            document.title = config.site_title || "瀬川研究室";
            const siteTitleLink = document.querySelector(".header h1 a");
            if (siteTitleLink) siteTitleLink.textContent = config.site_title || "瀬川研究室";
            const subtitle = document.querySelector(".header .subtitle");
            if (subtitle) subtitle.textContent = config.site_subtitle || "";
            const homeTitle = document.getElementById("home-title");
            if (homeTitle) homeTitle.textContent = config.home_title || "このサイトについて";
            const homeDesc = document.getElementById("home-desc");
            if (homeDesc) homeDesc.innerHTML = config.home_desc || "";
            const nisiTitle = document.getElementById("nisi-title");
            if (nisiTitle) nisiTitle.textContent = config.nisi_title || "日誌";
        }).catch(error => console.error('Failed to load config:', error));

        postsPromise.then(text => {
            const container = document.getElementById('blog-posts');
            if (!text || text.trim() === "") {
                container.innerHTML = '<p>まだ記事がありません。</p>';
                return;
            }
            container.innerHTML = '';
            const lines = text.split(/\r\n|\n/);
            const posts = [];
            let currentPost = null;
            const dateRegex = /^\d{4}\/\d{1,2}\/\d{1,2}\s*$/;

            for (let line of lines) {
                if (dateRegex.test(line.trim())) {
                    if (currentPost) posts.push(currentPost);
                    currentPost = { date: line.trim(), content: [] };
                } else if (currentPost) {
                    currentPost.content.push(line);
                }
            }
            if (currentPost) posts.push(currentPost);

            posts.forEach(post => {
                const postDiv = document.createElement('div');
                postDiv.className = 'post';
                const dateDiv = document.createElement('div');
                dateDiv.className = 'post-date';
                dateDiv.textContent = post.date;
                const contentDiv = document.createElement('div');
                contentDiv.className = 'post-content';
                contentDiv.innerHTML = post.content.join('\n'); 
                postDiv.appendChild(dateDiv);
                postDiv.appendChild(contentDiv);
                container.appendChild(postDiv);
            });
        }).catch(error => {
            console.error('Failed to load posts:', error);
            document.getElementById('blog-posts').textContent = '記事の読み込みに失敗しました。';
        });
    }

    loadPageData();
</script>
<script>
    if (window.location.hostname === "localhost") {
        const evtSource = new EventSource("/_livereload/events");
        evtSource.onmessage = function(event) {
            if (event.data === "reload") {
                location.reload();
            }
        };
    }
</script>
</body>
</html>
